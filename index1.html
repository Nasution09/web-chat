
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Simple Web Chat</title>
<style>
body {font-family: Arial; margin:0; background:#ece5dd;}
#login {height:100vh; display:flex; justify-content:center; align-items:center;}
#chat {display:none; height:100vh;}
.sidebar {width:30%; background:#075e54; color:white; padding:10px;}
.main {width:70%; display:flex; flex-direction:column;}
#users li {list-style:none; margin:5px 0;}
#messages {flex:1; padding:10px; overflow-y:auto;}
.msg {margin:5px 0; padding:8px; border-radius:8px; max-width:70%;}
.me {background:#dcf8c6; align-self:flex-end;}
.other {background:#fff; align-self:flex-start;}
.input {display:flex;}
input {flex:1; padding:10px; border:none;}
button {padding:10px; border:none; background:#075e54; color:white;}
</style>
</head>
<body>

<div id="login">
  <div>
    <h2>Masuk Chat</h2>
    <input id="username" placeholder="Nama kamu">
    <button onclick="join()">Masuk</button>
  </div>
</div>

<div id="chat">
  <div class="sidebar">
    <h3>Pengguna</h3>
    <ul id="users"></ul>
  </div>
  <div class="main">
    <div id="messages"></div>
    <div class="input">
      <input id="message" placeholder="Ketik pesan...">
      <button onclick="send()">Kirim</button>
    </div>
  </div>
</div>

<script>
const channel = new BroadcastChannel('chat_channel');
let user = '';

function join(){
  user = document.getElementById('username').value;
  if(!user) return alert('Isi nama dulu');

  document.getElementById('login').style.display='none';
  document.getElementById('chat').style.display='flex';

  let users = JSON.parse(localStorage.getItem('users') || '[]');
  if(!users.includes(user)) users.push(user);
  localStorage.setItem('users', JSON.stringify(users));

  channel.postMessage({type:'users'});
  loadUsers();
}

function send(){
  const text = document.getElementById('message').value;
  if(!text) return;

  const msg = {user, text};
  let msgs = JSON.parse(localStorage.getItem('messages') || '[]');
  msgs.push(msg);
  localStorage.setItem('messages', JSON.stringify(msgs));

  channel.postMessage({type:'message', data: msg});
  document.getElementById('message').value='';
  showMessage(msg);
}

function showMessage(msg){
  const div = document.createElement('div');
  div.className = 'msg ' + (msg.user === user ? 'me':'other');
  div.innerText = msg.user + ': ' + msg.text;
  document.getElementById('messages').appendChild(div);
}

function loadMessages(){
  const msgs = JSON.parse(localStorage.getItem('messages') || '[]');
  msgs.forEach(showMessage);
}

function loadUsers(){
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const ul = document.getElementById('users');
  ul.innerHTML='';
  users.forEach(u=>{
    const li=document.createElement('li');
    li.innerText=u;
    ul.appendChild(li);
  });
}

channel.onmessage = (e)=>{
  if(e.data.type==='message') showMessage(e.data.data);
  if(e.data.type==='users') loadUsers();
}

loadMessages();
loadUsers();
</script>
</body>
</html>
```
